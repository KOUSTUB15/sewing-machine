<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sewing Machine Log</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111">

<style>
body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: Arial;
    display: flex;
    justify-content: center;
}
.container {
    max-width: 420px;
    width: 100%;
    padding: 10px;
}
h2 {
    text-align: center;
    font-size: 18px;
}
video {
    width: 100%;
    border-radius: 8px;
}
.controls {
    display: flex;
    justify-content: space-between;
    margin: 8px 0;
}
button {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 5px;
    border: none;
}
.capture { background: #28a745; color: white; }
.reset { background: #dc3545; color: white; }

.card {
    background: #222;
    margin-bottom: 8px;
    padding: 6px;
    border-radius: 8px;
}
.card img {
    width: 100%;
    border-radius: 6px;
}
.info {
    font-size: 11px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.delete {
    font-size: 10px;
    padding: 4px 6px;
    background: #ff4444;
    color: white;
    border: none;
}
</style>
</head>

<body>
<div class="container">
<h2>ðŸ§µ Sewing Machine Log</h2>

<video id="video" autoplay playsinline></video>

<div class="controls">
<button class="capture" onclick="capture()">Capture</button>
<button class="reset" onclick="resetAll()">Reset</button>
</div>

<div id="list"></div>
</div>

<canvas id="canvas" hidden></canvas>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
}

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const list = document.getElementById('list');

navigator.mediaDevices.getUserMedia({
    video: { facingMode: { exact: "environment" } }
}).then(stream => video.srcObject = stream);

let data = JSON.parse(localStorage.getItem("machines")) || [];
render();

function capture() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    const img = canvas.toDataURL("image/png");

    const now = new Date();
    data.unshift({
        img,
        date: now.toLocaleDateString(),
        time: now.toLocaleTimeString()
    });
    localStorage.setItem("machines", JSON.stringify(data));
    render();
}

function render() {
    list.innerHTML = "";
    data.forEach((d, i) => {
        list.innerHTML += `
        <div class="card">
            <img src="${d.img}">
            <div class="info">
                <span>${d.date} ${d.time}</span>
                <button class="delete" onclick="del(${i})">Delete</button>
            </div>
        </div>`;
    });
}

function del(i) {
    data.splice(i,1);
    localStorage.setItem("machines", JSON.stringify(data));
    render();
}

function resetAll() {
    if(confirm("Delete all records?")) {
        localStorage.removeItem("machines");
        data = [];
        render();
    }
}
</script>
</body>
</html>
